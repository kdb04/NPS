2025-06-25 12:34:58,702 ERROR frappe Could not take error snapshot: current transaction is aborted, commands ignored until end of transaction block

Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-rgtsiuunza","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Contribution JV","status":"Pending","from_date":"2025-05-26","to_date":"2025-06-27","uploaded_file":"/private/files/JV_27.05.2025.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
Traceback (most recent call last):
  File "/home/nikhilsrivatsa/demo/apps/nps_app/nps_app/nps_app/doctype/nps_importer/nps_importer.py", line 248, in validate_against_database
    query_result = frappe.db.sql(validation_query, (query_from, query_to, query_from, query_to), as_dict=True)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/postgres/database.py", line 233, in sql
    return super().sql(modify_query(query), modify_values(values), *args, **kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 262, in sql
    self.execute_query(query, values)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 357, in execute_query
    return self._cursor.execute(query, values)
psycopg2.errors.SyntaxError: syntax error at or near "2025"
LINE 32:                     AND creation < ('2025-06-27'::DATE + INT...
                                              ^


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/nikhilsrivatsa/demo/apps/nps_app/nps_app/nps_app/doctype/nps_importer/nps_importer.py", line 128, in process_file
    validation_result = validate_against_database(jv_doc, doc.file_type)
  File "/home/nikhilsrivatsa/demo/apps/nps_app/nps_app/nps_app/doctype/nps_importer/nps_importer.py", line 420, in validate_against_database
    frappe.log_error(f"Validation error: {str(e)}", "NPS Validation Error")
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/utils/error.py", line 62, in log_error
    error_log = frappe.get_doc(
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/utils/__init__.py", line 217, in wrapper
    return func(*args, **kw)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 106, in get_doc
    return get_doc_from_dict(kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 140, in get_doc_from_dict
    controller = get_controller(data["doctype"])
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/base_document.py", line 83, in get_controller
    site_controllers[doctype] = import_controller(doctype)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/base_document.py", line 94, in import_controller
    doctype_info = frappe.db.get_value("DocType", doctype, ("module", "custom", "is_tree"), as_dict=True)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 547, in get_value
    result = self.get_values(
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 663, in get_values
    out = query.run(as_dict=as_dict, debug=debug, update=update, run=run, pluck=pluck)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/query_builder/utils.py", line 85, in execute_query
    result = frappe.local.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/postgres/database.py", line 233, in sql
    return super().sql(modify_query(query), modify_values(values), *args, **kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 262, in sql
    self.execute_query(query, values)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 357, in execute_query
    return self._cursor.execute(query, values)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/app.py", line 116, in application
    response = frappe.api.handle(request)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/api/__init__.py", line 49, in handle
    data = endpoint(**arguments)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/api/v1.py", line 36, in handle_rpc_call
    return frappe.handler.handle()
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/handler.py", line 51, in handle
    data = execute_cmd(cmd)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/handler.py", line 84, in execute_cmd
    return frappe.call(method, **frappe.form_dict)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/__init__.py", line 1461, in call
    return fn(*args, **newargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/utils/typing_validations.py", line 32, in wrapper
    return func(*args, **kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/desk/form/save.py", line 43, in savedocs
    doc.save()
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 484, in save
    return self._save(*args, **kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 506, in _save
    return self.insert()
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 432, in insert
    self.run_method("after_insert")
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 1128, in run_method
    out = Document.hook(fn)(self, *args, **kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 1517, in composer
    return composed(self, method, *args, **kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 1499, in runner
    add_to_return_value(self, f(self, method, *args, **kwargs))
  File "/home/nikhilsrivatsa/demo/apps/nps_app/nps_app/nps_app/doctype/nps_importer/nps_importer.py", line 178, in process_file
    frappe.log_error(frappe.get_traceback(), "NPS Importer Failure")
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/utils/error.py", line 62, in log_error
    error_log = frappe.get_doc(
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/utils/__init__.py", line 217, in wrapper
    return func(*args, **kw)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 106, in get_doc
    return get_doc_from_dict(kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 140, in get_doc_from_dict
    controller = get_controller(data["doctype"])
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/base_document.py", line 83, in get_controller
    site_controllers[doctype] = import_controller(doctype)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/base_document.py", line 94, in import_controller
    doctype_info = frappe.db.get_value("DocType", doctype, ("module", "custom", "is_tree"), as_dict=True)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 547, in get_value
    result = self.get_values(
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 663, in get_values
    out = query.run(as_dict=as_dict, debug=debug, update=update, run=run, pluck=pluck)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/query_builder/utils.py", line 85, in execute_query
    result = frappe.local.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/postgres/database.py", line 233, in sql
    return super().sql(modify_query(query), modify_values(values), *args, **kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 262, in sql
    self.execute_query(query, values)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 357, in execute_query
    return self._cursor.execute(query, values)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/utils/error.py", line 87, in log_error_snapshot
    log_error(title=str(exception), defer_insert=True)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/utils/error.py", line 62, in log_error
    error_log = frappe.get_doc(
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/utils/__init__.py", line 217, in wrapper
    return func(*args, **kw)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 106, in get_doc
    return get_doc_from_dict(kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/document.py", line 140, in get_doc_from_dict
    controller = get_controller(data["doctype"])
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/base_document.py", line 83, in get_controller
    site_controllers[doctype] = import_controller(doctype)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/model/base_document.py", line 94, in import_controller
    doctype_info = frappe.db.get_value("DocType", doctype, ("module", "custom", "is_tree"), as_dict=True)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 547, in get_value
    result = self.get_values(
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 663, in get_values
    out = query.run(as_dict=as_dict, debug=debug, update=update, run=run, pluck=pluck)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/query_builder/utils.py", line 85, in execute_query
    result = frappe.local.db.sql(query, params, *args, **kwargs)  # nosemgrep
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/postgres/database.py", line 233, in sql
    return super().sql(modify_query(query), modify_values(values), *args, **kwargs)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 262, in sql
    self.execute_query(query, values)
  File "/home/nikhilsrivatsa/demo/apps/frappe/frappe/database/database.py", line 357, in execute_query
    return self._cursor.execute(query, values)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block

2025-07-02 14:12:57,364 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-wkjwryjgyf","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-02 14:18:40,641 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-bfamyjsaki","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-02 14:19:10,447 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-mhagvpxwxk","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-02 14:50:29,859 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-mejevtnwvb","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-02 14:52:14,027 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-rvyeetcurn","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-02 15:42:13,510 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-ydntvmtopl","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions-2.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-02 15:52:58,537 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-mqrbqrxsjg","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-02 15:55:33,792 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-gxdbvmbxxc","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-02 23:18:07,576 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-ozhstplnrb","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 09:54:18,378 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-irzillqywk","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 09:56:18,352 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-irzillqywk","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 10:18:53,274 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-qzzgttdnza","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 10:20:00,094 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-qzzgttdnza","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 10:21:44,784 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-qzzgttdnza","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 10:25:26,314 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-qizcvaegmn","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 10:36:12,805 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-xmccvmuicx","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions-2.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 10:37:52,890 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-bfpvlucjie","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions-2.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 11:39:12,438 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-janwfioxkt","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions-2.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 11:42:30,001 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-hvkofeclyn","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions-2.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 12:19:34,906 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-muyfglfymt","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 12:22:07,861 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-trbithbfxy","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 12:25:17,217 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-jdpvvhxzri","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
2025-07-03 12:33:08,570 ERROR frappe New Exception collected in error log
Site: NPS.local
Form Dict: {'doc': '{"docstatus":0,"doctype":"NPS Importer","name":"new-nps-importer-memuzjypdu","__islocal":1,"__unsaved":1,"owner":"Administrator","file_type":"Comparison JV","status":"Pending","uploaded_file":"/private/files/transactions.csv"}', 'action': 'Save', 'cmd': 'frappe.desk.form.save.savedocs'}
