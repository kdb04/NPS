2025-06-16 19:41:50,109 INFO ipython === bench console session ===
2025-06-16 19:41:50,109 INFO ipython === session end ===
2025-06-16 19:42:08,045 INFO ipython === bench console session ===
2025-06-16 19:42:08,046 INFO ipython import frappe
2025-06-16 19:42:08,046 INFO ipython === session end ===
2025-07-01 14:47:00,905 INFO ipython === bench console session ===
2025-07-01 14:47:00,910 INFO ipython query = """
SELECT t.order_id 
FROM "tabNPS Transaction" t
LEFT JOIN tabnps_contribution c ON t.order_id = c.order_id
WHERE t.order_id IS NOT NULL
AND t.settlement_id IS NULL
AND t.description IS NULL;
"""

result = frappe.db.sql(query, as_dict=True)
result
2025-07-01 14:47:00,910 INFO ipython === session end ===
2025-07-01 14:50:44,467 INFO ipython === bench console session ===
2025-07-01 14:50:44,467 INFO ipython query = """CREATE TEMP TABLE "tabNPS Transaction"(
                entity_id varchar(50), 
                type varchar(30), 
                debit float, 
                credit float, 
                amount float, 
                currency varchar(10), 
                fee float, 
                tax float, 
                on_hold int, 
                settled int, 
                created_at timestamp, 
                settled_at date, 
                settlement_id varchar(50), 
                description varchar(100), 
                notes json, 
                payment_id varchar(50), 
                arn varchar(50), 
                settlement_utr varchar(50), 
                order_id varchar(50), 
                order_receipt varchar(50), 
                method varchar(30), 
                upi_flow varchar(50), 
                card_network varchar(50), 
                card_issuer varchar(50), 
                card_type varchar(50), 
                dispute_id varchar(50), 
                additional_utr varchar(50)
                );"""
2025-07-01 14:50:44,467 INFO ipython frappe.db.sql(query)
2025-07-01 14:50:44,467 INFO ipython frappe.db.sql("""CREATE TEMP TABLE "tabNPS Transaction"(
                entity_id varchar(50), 
                type varchar(30), 
                debit float, 
                credit float, 
                amount float, 
                currency varchar(10), 
                fee float, 
                tax float, 
                on_hold int, 
                settled int, 
                created_at timestamp, 
                settled_at date, 
                settlement_id varchar(50), 
                description varchar(100), 
                notes json, 
                payment_id varchar(50), 
                arn varchar(50), 
                settlement_utr varchar(50), 
                order_id varchar(50), 
                order_receipt varchar(50), 
                method varchar(30), 
                upi_flow varchar(50), 
                card_network varchar(50), 
                card_issuer varchar(50), 
                card_type varchar(50), 
                dispute_id varchar(50), 
                additional_utr varchar(50)
                );""")
2025-07-01 14:50:44,467 INFO ipython frappe.db.sql("""DROP TABLE IF EXISTS "tabNPS Transaction"""")
2025-07-01 14:50:44,467 INFO ipython frappe.db.sql("""DROP TABLE IF EXISTS "tabNPS Transaction";""")
2025-07-01 14:50:44,467 INFO ipython frappe.db.sql("""CREATE TEMP TABLE "tabNPS Transaction"(
                entity_id varchar(50), 
                type varchar(30), 
                debit float, 
                credit float, 
                amount float, 
                currency varchar(10), 
                fee float, 
                tax float, 
                on_hold int, 
                settled int, 
                created_at timestamp, 
                settled_at date, 
                settlement_id varchar(50), 
                description varchar(100), 
                notes json, 
                payment_id varchar(50), 
                arn varchar(50), 
                settlement_utr varchar(50), 
                order_id varchar(50), 
                order_receipt varchar(50), 
                method varchar(30), 
                upi_flow varchar(50), 
                card_network varchar(50), 
                card_issuer varchar(50), 
                card_type varchar(50), 
                dispute_id varchar(50), 
                additional_utr varchar(50)
                );""")
2025-07-01 14:50:44,467 INFO ipython === session end ===
2025-07-01 14:58:41,511 INFO ipython === bench console session ===
2025-07-01 14:58:41,511 INFO ipython frappe.get_sites()
2025-07-01 14:58:41,511 INFO ipython frappe.db.sql('SELECT * FROM "tabnps_contribution" LIMIT 5', as_dict=True)
2025-07-01 14:58:41,511 INFO ipython frappe.db.sql('CREATE TEMP TABLE "tabNPS Transaction"(
                entity_id varchar(50), 
                type varchar(30), 
                debit float, 
                credit float, 
                amount float, 
                currency varchar(10), 
                fee float, 
                tax float, 
                on_hold int, 
                settled int, 
                created_at timestamp, 
                settled_at date, 
                settlement_id varchar(50), 
                description varchar(100), 
                notes json, 
                payment_id varchar(50), 
                arn varchar(50), 
                settlement_utr varchar(50), 
                order_id varchar(50), 
                order_receipt varchar(50), 
                method varchar(30), 
                upi_flow varchar(50), 
                card_network varchar(50), 
                card_issuer varchar(50), 
                card_type varchar(50), 
                dispute_id varchar(50), 
                additional_utr varchar(50)
                );')
2025-07-01 14:58:41,511 INFO ipython frappe.db.sql('''
CREATE TEMP TABLE "tabNPS Transaction" (
    entity_id varchar(50),
    type varchar(30),
    debit float,
    credit float,
    amount float,
    currency varchar(10),
    fee float,
    tax float,
    on_hold int,
    settled int,
    created_at timestamp,
    settled_at date,
    settlement_id varchar(50),
    description varchar(100),
    notes json,
    payment_id varchar(50),
    arn varchar(50),
    settlement_utr varchar(50),
    order_id varchar(50),
    order_receipt varchar(50),
    method varchar(30),
    upi_flow varchar(50),
    card_network varchar(50),
    card_issuer varchar(50),
    card_type varchar(50),
    dispute_id varchar(50),
    additional_utr varchar(50)
);
''')
2025-07-01 14:58:41,511 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction" 
                ALTER COLUMN entity_id SET NOT NULL, 
                ALTER COLUMN type SET NOT NULL, 
                ALTER COLUMN debit SET NOT NULL, 
                ALTER COLUMN credit SET NOT NULL, 
                ALTER COLUMN amount SET NOT NULL, 
                ALTER COLUMN currency SET NOT NULL, 
                ALTER COLUMN fee SET NOT NULL, 
                ALTER COLUMN tax SET NOT NULL, 
                ALTER COLUMN on_hold SET NOT NULL, 
                ALTER COLUMN settled SET NOT NULL, 
                ALTER COLUMN created_at SET NOT NULL, 
                ALTER COLUMN settled_at SET NOT NULL;
                """)
2025-07-01 14:58:41,511 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction" 
                ADD CONSTRAINT entity_id_unique UNIQUE(entity_id), 
                ADD CONSTRAINT order_id_unique UNIQUE(order_id), 
                ADD CONSTRAINT order_receipt_unique UNIQUE(order_receipt);
                """)
2025-07-01 14:58:41,511 INFO ipython frappe.db.sql(""" 
                ALTER TABLE "tabNPS Transaction"
                ALTER COLUMN created_at TYPE TEXT, 
                ALTER COLUMN settled_at TYPE TEXT
                """)
2025-07-01 14:58:41,511 INFO ipython frappe.db.sql("""
                COPY "tabNPS Transaction" FROM "/tmp/transactions.csv" DELIMITER ',' CSV HEADER;
                """)
2025-07-01 14:58:41,511 INFO ipython frappe.db.sql("""
                COPY "tabNPS Transaction" FROM '/tmp/transactions.csv' DELIMITER ',' CSV HEADER;
                """)
2025-07-01 14:58:41,511 INFO ipython === session end ===
2025-07-01 15:03:24,093 INFO ipython === bench console session ===
2025-07-01 15:03:24,093 INFO ipython frappe.db.sql('''
CREATE TEMP TABLE "tabNPS Transaction" (
    entity_id varchar(50),
    type varchar(30),
    debit float,
    credit float,
    amount float,
    currency varchar(10),
    fee float,
    tax float,
    on_hold int,
    settled int,
    created_at timestamp,
    settled_at date,
    settlement_id varchar(50),
    description varchar(100),
    notes json,
    payment_id varchar(50),
    arn varchar(50),
    settlement_utr varchar(50),
    order_id varchar(50),
    order_receipt varchar(50),
    method varchar(30),
    upi_flow varchar(50),
    card_network varchar(50),
    card_issuer varchar(50),
    card_type varchar(50),
    dispute_id varchar(50),
    additional_utr varchar(50)
);
''')
2025-07-01 15:03:24,093 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction" 
                ALTER COLUMN entity_id SET NOT NULL, 
                ALTER COLUMN type SET NOT NULL, 
                ALTER COLUMN debit SET NOT NULL, 
                ALTER COLUMN credit SET NOT NULL, 
                ALTER COLUMN amount SET NOT NULL, 
                ALTER COLUMN currency SET NOT NULL, 
                ALTER COLUMN fee SET NOT NULL, 
                ALTER COLUMN tax SET NOT NULL, 
                ALTER COLUMN on_hold SET NOT NULL, 
                ALTER COLUMN settled SET NOT NULL, 
                ALTER COLUMN created_at SET NOT NULL, 
                ALTER COLUMN settled_at SET NOT NULL;
                """)
2025-07-01 15:03:24,093 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction" 
                ADD CONSTRAINT entity_id_unique UNIQUE(entity_id), 
                ADD CONSTRAINT order_id_unique UNIQUE(order_id), 
                ADD CONSTRAINT order_receipt_unique UNIQUE(order_receipt);
                """)
2025-07-01 15:03:24,094 INFO ipython frappe.db.sql(""" 
                ALTER TABLE "tabNPS Transaction"
                ALTER COLUMN created_at TYPE TEXT, 
                ALTER COLUMN settled_at TYPE TEXT
                """)
2025-07-01 15:03:24,094 INFO ipython frappe.db.sql("""
                COPY "tabNPS Transaction" FROM '/tmp/transactions.csv' DELIMITER ',' CSV HEADER;
                """)
2025-07-01 15:03:24,094 INFO ipython frappe.db.sql("""
                \COPY "tabNPS Transaction" FROM '/tmp/transactions.csv' DELIMITER ',' CSV HEADER;
                """)
2025-07-01 15:03:24,094 INFO ipython frappe.db.sql("""
                COPY "tabNPS Transaction" FROM '/tmp/transactions.csv' DELIMITER ',' CSV HEADER;
                """)
2025-07-01 15:03:24,094 INFO ipython === session end ===
2025-07-01 15:08:03,705 INFO ipython === bench console session ===
2025-07-01 15:08:03,705 INFO ipython frappe.db.sql("""
                CREATE TEMP TABLE "tabNPS Transaction"(
                entity_id varchar(50), 
                type varchar(30), 
                debit float, 
                credit float, 
                amount float, 
                currency varchar(10), 
                fee float, 
                tax float, 
                on_hold int, 
                settled int, 
                created_at timestamp, 
                settled_at date, 
                settlement_id varchar(50), 
                description varchar(100), 
                notes json, 
                payment_id varchar(50), 
                arn varchar(50), 
                settlement_utr varchar(50), 
                order_id varchar(50), 
                order_receipt varchar(50), 
                method varchar(30), 
                upi_flow varchar(50), 
                card_network varchar(50), 
                card_issuer varchar(50), 
                card_type varchar(50), 
                dispute_id varchar(50), 
                additional_utr varchar(50)
                );""")
2025-07-01 15:08:03,737 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction" 
                ALTER COLUMN entity_id SET NOT NULL, 
                ALTER COLUMN type SET NOT NULL, 
                ALTER COLUMN debit SET NOT NULL, 
                ALTER COLUMN credit SET NOT NULL, 
                ALTER COLUMN amount SET NOT NULL, 
                ALTER COLUMN currency SET NOT NULL, 
                ALTER COLUMN fee SET NOT NULL, 
                ALTER COLUMN tax SET NOT NULL, 
                ALTER COLUMN on_hold SET NOT NULL, 
                ALTER COLUMN settled SET NOT NULL, 
                ALTER COLUMN created_at SET NOT NULL, 
                ALTER COLUMN settled_at SET NOT NULL;
                """)
2025-07-01 15:08:03,737 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction" 
                ADD CONSTRAINT entity_id_unique UNIQUE(entity_id), 
                ADD CONSTRAINT order_id_unique UNIQUE(order_id), 
                ADD CONSTRAINT order_receipt_unique UNIQUE(order_receipt);
                """)
2025-07-01 15:08:03,737 INFO ipython frappe.db.sql(""" 
                ALTER TABLE "tabNPS Transaction"
                ALTER COLUMN created_at TYPE TEXT, 
                ALTER COLUMN settled_at TYPE TEXT
                """)
2025-07-01 15:08:03,737 INFO ipython frappe.db.sql("""
                COPY "tabNPS Transaction" FROM '/tmp/transactions.csv' DELIMITER ',' CSV HEADER;
                """)
2025-07-01 15:08:03,737 INFO ipython === session end ===
2025-07-01 15:11:01,082 INFO ipython === bench console session ===
2025-07-01 15:11:01,082 INFO ipython frappe.db.sql("""
                CREATE TEMP TABLE "tabNPS Transaction"(
                entity_id varchar(50), 
                type varchar(30), 
                debit float, 
                credit float, 
                amount float, 
                currency varchar(10), 
                fee float, 
                tax float, 
                on_hold int, 
                settled int, 
                created_at timestamp, 
                settled_at date, 
                settlement_id varchar(50), 
                description varchar(100), 
                notes json, 
                payment_id varchar(50), 
                arn varchar(50), 
                settlement_utr varchar(50), 
                order_id varchar(50), 
                order_receipt varchar(50), 
                method varchar(30), 
                upi_flow varchar(50), 
                card_network varchar(50), 
                card_issuer varchar(50), 
                card_type varchar(50), 
                dispute_id varchar(50), 
                additional_utr varchar(50)
                );""")
2025-07-01 15:11:01,082 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction" 
                ALTER COLUMN entity_id SET NOT NULL, 
                ALTER COLUMN type SET NOT NULL, 
                ALTER COLUMN debit SET NOT NULL, 
                ALTER COLUMN credit SET NOT NULL, 
                ALTER COLUMN amount SET NOT NULL, 
                ALTER COLUMN currency SET NOT NULL, 
                ALTER COLUMN fee SET NOT NULL, 
                ALTER COLUMN tax SET NOT NULL, 
                ALTER COLUMN on_hold SET NOT NULL, 
                ALTER COLUMN settled SET NOT NULL, 
                ALTER COLUMN created_at SET NOT NULL, 
                ALTER COLUMN settled_at SET NOT NULL;
                """)
2025-07-01 15:11:01,082 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction" 
                ADD CONSTRAINT entity_id_unique UNIQUE(entity_id), 
                ADD CONSTRAINT order_id_unique UNIQUE(order_id), 
                ADD CONSTRAINT order_receipt_unique UNIQUE(order_receipt);
                """)
2025-07-01 15:11:01,082 INFO ipython frappe.db.sql(""" 
                ALTER TABLE "tabNPS Transaction"
                ALTER COLUMN created_at TYPE TEXT, 
                ALTER COLUMN settled_at TYPE TEXT
                """)
2025-07-01 15:11:01,082 INFO ipython frappe.db.sql("""
                COPY "tabNPS Transaction" FROM '/tmp/transactions.csv' DELIMITER ',' CSV HEADER;
                """)
2025-07-01 15:11:01,082 INFO ipython frappe.db.sql('select * from "tabNPS Transaction" limit 1');
2025-07-01 15:11:01,082 INFO ipython frappe.db.sql('select * from "tabNPS Transaction" limit 1;')
2025-07-01 15:11:01,083 INFO ipython frappe.db.sql("""
                ALTER TABLE "tabNPS Transaction"
                ALTER COLUMN created_at TYPE TIMESTAMP USING TO_TIMESTAMP(created_at, 'DD/MM/YYYY HH24:MI:SS'),
                ALTER COLUMN settled_at TYPE DATE USING TO_DATE(settled_at, 'DD-MM-YYYY');
                """)
2025-07-01 15:11:01,083 INFO ipython frappe.db.sql('select * from "tabNPS Transaction" limit 1;')
2025-07-01 15:11:01,083 INFO ipython frappe.db.sql("""
                SELECT t.order_id 
                FROM "tabNPS Transaction" t
                LEFT JOIN tabnps_contribution c
                ON t.order_id = c.order_id 
                WHERE t.order_id IS NOT NULL
                AND t.settled_at IS NOT NULL
                AND t.description IS NOT NULL
                AND c.order_id IS NULL;
                """)
2025-07-01 15:11:01,083 INFO ipython === session end ===
2025-07-01 15:23:09,118 INFO ipython === bench console session ===
2025-07-01 15:23:09,118 INFO ipython === session end ===
